<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">

        <title>USB Cameras</title>

		[CSS]
     
        <style>
            body {
              font-size: .875rem;
            }
            .feather {
              width: 16px;
              height: 16px;
              vertical-align: text-bottom;
            }
            html {
              position: relative;
              min-height: 100%;
            }
            body {
              /* Margin bottom by footer height */
              margin-bottom: 60px;
            }
            .footer {
              position: absolute;
              bottom: 0;
              width: 100%;
              /* Set the fixed height of the footer here */
              height: 60px;
              line-height: 60px; /* Vertically center the text there */
              background-color: #f5f5f5;
            }
            body > .container {
              padding: 60px 15px 0;
            }
            .footer > .container {
              padding-right: 15px;
              padding-left: 15px;
            }
            code {
              font-size: 80%;
            }
        </style>

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>
	<body>
		<main role="main" class="container">
        	<div class="row">
        	    <div class="col-lg-12">
        	        <div class="card">
						<div class="card-body">
							<br>
							<h6 class="d-flex justify-content-between align-items-center mb-3">
								<span class="text-muted">Connected Devices</span>
								<span class="badge badge-secondary badge-pill" id="devices_count_id">0</span>
							</h6>
							<div class="card">
								<div class="card-body">
									<div id="devices_list_id"></div>
								</div>
							</div>
							<br>
							<h6 class="d-flex justify-content-between align-items-center mb-3">
								<span class="text-muted">Sensors</span>
								<span class="badge badge-secondary badge-pill" id="sensors_count_id">0</span>
							</h6>
							<div id="sensors_list_id"></div>
						</div>
                  	</div>
        	    </div>
			</div>
        </main>
		
		<!-- Modal -->
		<div class="modal fade bd-example-modal-xl" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-xl" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel">Settings</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<div class="row">
							<div class="col-2">
								<div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
								<a class="nav-link active" id="v-pills-info-tab" data-toggle="pill" href="#v-pills-info" role="tab" aria-controls="v-pills-info" aria-selected="true">Information</a>
								<a class="nav-link" id="v-pills-rec-tab" data-toggle="pill" href="#v-pills-rec" role="tab" aria-controls="v-pills-rec" aria-selected="false">Recording</a>
								<a class="nav-link" id="v-pills-files-tab" data-toggle="pill" href="#v-pills-files" role="tab" aria-controls="v-pills-files" aria-selected="false">Files</a>
								<a class="nav-link" id="v-pills-image-tab" data-toggle="pill" href="#v-pills-image" role="tab" aria-controls="v-pills-image" aria-selected="false">Image Settings</a>
								</div>
							</div>
							<div class="col-10">
								<div class="tab-content" id="v-pills-tabContent">
									<div class="tab-pane fade show active" id="v-pills-info" role="tabpanel" aria-labelledby="v-pills-info-tab">
										<div class="row">
											<div class="col-lg-6">
												<div class="card">
													<div class="card-body">
														<h7 class="d-flex justify-content-between align-items-center mb-3">
															<span class="text-muted">UID</span>
															<span class="text-muted" id="id_uid">N/A</span>
														</h7>
														<h7 class="d-flex justify-content-between align-items-center mb-3">
															<span class="text-muted">Device Path</span>
															<span class="text-muted" id="id_dev">N/A</span>
														</h7>
														<h7 class="d-flex justify-content-between align-items-center mb-3">
															<span class="text-muted">Current FPS</span>
															<span class="text-muted" id="txt_fps">1.6 fps</span>
														</h7>
														<h7 class="d-flex justify-content-between align-items-center mb-3">
															<span class="text-muted">Name</span>
															<a href="#" id="txt_name">No Name</a>
														</h7>
														<h7 class="d-flex justify-content-between align-items-center mb-3">
															<span class="text-muted">eMail</span>
															<a href="#" id="txt_email">mail@gmail.com</a>
														</h7>
														<h7 class="d-flex justify-content-between align-items-center mb-3">
															<span class="text-muted">Phone (SMS)</span>
															<a href="#" id="txt_phone">+97254123456</a>
														</h7>
													</div>
												</div>
											</div>
											<div class="col-lg-6">
												<div class="card">
													<div class="card-body">
														<h6 class="d-flex justify-content-between align-items-center mb-3">
															<span class="text-muted">Precentage till next video creation</span>
														</h6>
														<div class="progress">
															<div id="progressCapture" class="progress-bar" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25%</div>
														</div>
													</div>
													<div class="card-body">
														<div class="custom-control custom-switch">
															<input type="checkbox" class="custom-control-input" id="accesswww">
															<label class="custom-control-label" for="accesswww">Access camera from anywere</label>
														</div>
														<div class="custom-control custom-switch">
															<input type="checkbox" class="custom-control-input" id="motion_detection">
															<label class="custom-control-label" for="motion_detection">Motion Detection</label>
														</div>
														<div class="custom-control custom-switch">
															<input type="checkbox" class="custom-control-input" id="camera_recording">
															<label class="custom-control-label" for="camera_recording">Recording</label>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
						<button type="button" class="btn btn-primary" onclick="SetMiscInfo()">Save changes</button>
					</div>
				</div>
			</div>
		</div>
		</main>

		[SCRIPTS]

        <script>
          	var GatewayIP = "[GATEWAY_IP]";
			var NodeUUID  = "[NODE_UUID]";
			
			// Gey makesense api instanse.
			var api = MkSAPIBuilder.GetInstance();
			api.SetGlobalGatewayIP(GatewayIP);

			var DeviceCell = `
					<div class="card">
						<div class="card-body">
							<div class="row">
								<div class="col-lg-4">
									<small class="my-0">[NAME]</small>
								</div>
								<div class="col-lg-6">
								</div>
								<div class="col-lg-2">
									<span onClick="OpenModal(this,'[ID]','[RF_TYPE]');" style="width: 16px; height: 16px; cursor: pointer;color: green" data-feather="download"></span>
								</div>
							</div>
						</div>
					</div>
			`;

			var SensorCell = `
					<div class="card">
						<div class="card-body">
							<div class="row">
								<div class="col-lg-1 align-items-center">
									[ICON]
								</div>
								<div class="col-lg-4">
									<small class="my-0">[NAME]</small>
								</div>
								<div class="col-lg-5">
								</div>
								<div class="col-lg-1">
									[SENSOR]
								</div>
								<div class="col-lg-1">
									<span onClick="OpenModal(this,'[ID]','[RF_TYPE]');" style="width: 16px; height: 16px; cursor: pointer;color: green" data-feather="settings"></span>
								</div>
							</div>
						</div>
					</div>
					</br>
			`;

			var SensorUIGenerate = function(sensor) {
				html = SensorCell;
				html = html.split("[ID]").join(sensor.addr);
				html = html.split("[NAME]").join(sensor.name);
				html = html.split("[RF_TYPE]").join(sensor.rf_type);

				var htmlType = "";
				switch(sensor.type) {
					case 1:
					html = html.split("[ICON]").join(`<span style="width: 16px; height: 16px; color: red" data-feather="sun"></span>`);
					htmlType = `
						<div class="custom-control custom-switch">
							<input type="checkbox" class="custom-control-input" [DISABLED] [STATE] onchange="SwitchChanged(this, [ADDR]);" id="switch_id_[SWITCH_ID]">
							<label class="custom-control-label" for="switch_id_[SWITCH_ID]"></label>
						</div>
					`;
					htmlType = htmlType.split("[DISABLED]").join("");
					htmlType = htmlType.split("[STATE]").join("checked");
					htmlType = htmlType.split("[SWITCH_ID]").join(sensor.id);
					htmlType = htmlType.split("[ADDR]").join(sensor.addr);
					break;
				}
				html = html.split("[SENSOR]").join(htmlType);
				return html;
			}

			var SwitchChanged = function(elem, addr) {
				var value = 0;
				if (elem.checked) {
					var value = 1;
				}

				api.SendCustomCommand(NodeUUID, "write_sensor_info", {
					addr: addr,
					value: value
				}, function(res) { });
			};

			var OnNodeChangeEvent = function(packet) {
				console.log("OnNodeChangeEvent", packet.data.payload.event);
			}

			api.ConnectGateway(function() {
				console.log("Connection to Gateway was established.");
				api.Gateway.OnNodeChangeEvent = OnNodeChangeEvent;

				api.GetNodeSensorsInfo(NodeUUID, function(res) {
					data = res.data.payload;
					sensors = data.sensors;
					devices = data.devices;

					var htmlSensors = ""
					for (var key in sensors) {
						sensor = sensors[key];
						htmlSensors += SensorUIGenerate(sensor);
					}
					document.getElementById("sensors_list_id").innerHTML = htmlSensors;
					document.getElementById("sensors_count_id").innerHTML = sensors.length;
					
              		feather.replace();
				});
			});

			$('#exampleModal').on('hide.bs.modal', function (e) {
				clearInterval(CurrentCamera.Handle);
			})

			var OpenModal = function (elem, camera_dev, camera_uid) {
				$('#exampleModal').modal('show')
			}

			feather.replace();
        </script>
    </body>
</html>