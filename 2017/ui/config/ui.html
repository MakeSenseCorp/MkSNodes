<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">

        <title>YouTube Player</title>

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
     
        <style>
            body {
              font-size: .875rem;
            }
            .feather {
              width: 16px;
              height: 16px;
              vertical-align: text-bottom;
            }
            html {
              position: relative;
              min-height: 100%;
            }
            body {
              /* Margin bottom by footer height */
              margin-bottom: 60px;
            }
            .footer {
              position: absolute;
              bottom: 0;
              width: 100%;
              /* Set the fixed height of the footer here */
              height: 60px;
              line-height: 60px; /* Vertically center the text there */
              background-color: #f5f5f5;
            }
            body > .container {
              padding: 60px 15px 0;
            }
            .footer > .container {
              padding-right: 15px;
              padding-left: 15px;
            }
            code {
              font-size: 80%;
            }
        </style>

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>
    <body>
        <main role="main" class="container">
        	<div class="row">
        	    <div class="col-lg-12">
        	        <div class="card">

                    <div class="card-body">
                      <h6 class="d-flex justify-content-between align-items-center mb-3">
                        <span class="text-muted">Cameras List (<a href="#" onclick="GetFrameFromAllCameras()">Refresh</a>)</span>
                        <span class="badge badge-secondary badge-pill" id="cameras_count_id">0</span>
                      </h6>
                      	<div id="cameras_list_id"></div>
                    </div>
                  </div>
        	    </div>
        	</div>
        </main>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.19.0/feather.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.19.0/feather.min.js.map"></script>
        
        <script src="mksdk-js/MkSAPI.js"></script>
        <script src="mksdk-js/MkSCommon.js"></script>
        <script src="mksdk-js/MkSGateway.js"></script>
        <script src="mksdk-js/MkSWebface.js"></script>

        <script>
          	var NodeUUID = "ac6de837-9863-72a9-c789-a0aae7e9d021";

			// Gey makesense api instanse.
			var api = MkSAPIBuilder.GetInstance();

			var CameraCell = `
						<div class="col-lg-6">
		                    <div class="card">
								<div class="card-body">
									<h6 class="d-flex justify-content-between align-items-center mb-3">
										<span class="text-muted">[NAME]</span>
									</h6>
									<div class="row">
										<div class="col-lg-12">
											<img width="100%" src="http://[IPADDRESS]/tmpfs/auto.jpg?t=" onload="setTimeout(function(){src=src.substring(0, (src.lastIndexOf('t=')+2))+(new Date()).getTime()}, 1000)"/>
										</div>
				  					</div><br>
									<div class="row">
										<div class="col-lg-3">
											<center><span onClick="Recording(this, '[CAMERA_MAC]', '[CAMERA_UID]');" style="width: 16px; height: 16px; cursor: pointer;color: red" data-feather="circle"></span></center>
										</div>
										<div class="col-lg-3">
											<center><span onClick="Motion(this, '[CAMERA_MAC]', '[CAMERA_UID]');" style="width: 16px; height: 16px; cursor: pointer;color: black" data-feather="users"></span></center>
										</div>
										<div class="col-lg-3">
											<center><span onClick="Security(this, '[CAMERA_MAC]', '[CAMERA_UID]');" style="width: 16px; height: 16px; cursor: pointer;color: black" data-feather="shield"></span></center>
										</div>
										<div class="col-lg-3">
											<center><span onClick="" style="width: 16px; height: 16px; cursor: pointer;color: green" data-feather="settings"></span></center>
										</div>
				  					</div>
								</div>
							</div>
						</div>
          `;
			
			api.ConnectGateway(function() {
				console.log("Connection to Gateway was established.");

				api.GetNodeSensorsInfo(NodeUUID, function(res){
					cameras = res.data.payload;
					var html = "";
					var cameraCount = cameras.length;
					for (i = 0; i < cameraCount; i++) {
						camera = cameras[i];
						if (i % 2) {
							html += `<div class="row">`;
						}

						row = CameraCell;
				        row = row.split("[NAME]").join(camera.name);
				        row = row.split("[IPADDRESS]").join(camera.ip);
						row = row.split("[CAMERA_MAC]").join(camera.mac);
						row = row.split("[CAMERA_UID]").join(camera.uid);
				        html += row;

						if (i % 2 != 0) {
							html += `</div>`;
						}
					}

					document.getElementById("cameras_count_id").innerHTML = cameraCount;
					document.getElementById("cameras_list_id").innerHTML = html;
              		feather.replace();
				});
			});

			var Recording = function(elem, camera_mac, camera_uid) {
				var action = (elem.style.color == 'red') ? false:true;

				if (action) {
					api.SendCustomCommand(NodeUUID, "start_recording", {
						mac: camera_mac,
						uid: camera_uid
					}, function(res) {
						console.log(res);
						elem.style.color = "red";
					});
				} else {
					api.SendCustomCommand(NodeUUID, "stop_recording", {
						mac: camera_mac,
						uid: camera_uid
					}, function(res) {
						console.log(res);
						elem.style.color = "green";
					});
				}
			}

			var Motion = function(elem, camera_mac, camera_uid) {
				var action = (elem.style.color == 'black') ? true:false;

				if (action) {
					api.SendCustomCommand(NodeUUID, "start_motion_detection", {
						mac: camera_mac,
						uid: camera_uid
					}, function(res) {
						console.log(res);
						elem.style.color = "red";
					});
				} else {
					api.SendCustomCommand(NodeUUID, "stop_motion_detection", {
						mac: camera_mac,
						uid: camera_uid
					}, function(res) {
						console.log(res);
						elem.style.color = "black";
					});
				}
			}

			var Security = function(elem, camera_mac, camera_uid) {
				var action = (elem.style.color == 'black') ? true:false;

				if (action) {
					api.SendCustomCommand(NodeUUID, "start_security", {
						mac: camera_mac,
						uid: camera_uid
					}, function(res) {
						console.log(res);
						elem.style.color = "red";
					});
				} else {
					api.SendCustomCommand(NodeUUID, "stop_security", {
						mac: camera_mac,
						uid: camera_uid
					}, function(res) {
						console.log(res);
						elem.style.color = "black";
					});
				}
			}

			feather.replace();
        </script>
    </body>
</html>
